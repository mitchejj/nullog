<!DOCTYPE html>
<html lang=en-US>
  <meta content="width=device-width,initial-scale=1" name=viewport>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <meta content=nullog property=og:site_name>
  <meta content=en_US property=og:locale>
  <meta content=article property=og:type>
  <meta content="Now you have Arch Linux installed on a Raspberry Pi, what should you do?" property=og:description>
  <meta content="Getting Started Guide" property=og:title>
  <meta content=https://nullog.net/io/pi/rasp-arch-next/ property=og:url>
  <meta content="Jason Mitchell" property=article:author>
  <meta content="" property=article:tag>
  <meta content=summary name=twitter:card>
  <meta content=@_nullog name=twitter:site>
  <meta content=@mitchejj name=twitter:creator>
  <link href=//humans.txt rel=author type=text/plain>
  <title>Getting Started Guide | nullog</title>
  <link href=https://nullog.net//io/pi/rasp-arch-next/ rel=canonical>
  <link href=/nullog.css rel=stylesheet>
  <body class=nullog>
    <header class="center site-header">
      <h1 class="center lowercase site-title">
        <a href=/>nullog</a>
      </h1>
      <nav class="lowercase site-nav">
        <ul>
          <li class=nav-node>
            <h2 class=small>
              <a href=/about/>about</a>
            </h2>
            <li class=nav-node>
              <h2 class=small>
                <a href=/all/>explore</a>
              </h2>
              <li class=nav-node>
                <h2 class=small>
                  <a href=/io/>io</a>
                </h2>
        </ul>
      </nav>
    </header>
    <main class=nullog-body>
      <article class=page>
        <header class=title>
          <h2 class=lowercase>Getting Started Guide
            <span class=mute> Arch Raspberry Pi 2</span>
          </h2>
        </header>
        <p>This, getting start guide was actually created before my
          <a href=/io/pi/rasp-arch-install/>Arch Linux ARM Raspberry Pi 2 install guide</a>, and the chances are good you are here because of it. I felt a tad overwhelmed trying to figure out the best, most logical, path from the primordial ooze of a tarball to what I deemed to be a good
          solid foundation. In order to organize my thoughts I had to map out a plan; identify flaw and blind spots.
          <p>The same conventions used in the
            <a href=/io/pi/rasp-arch-install/>install guide</a> will be used here. I expected the Pi setup to all take place via SSH, therefore that decision will influence the order of operations.
            <h3 id=finding-the-pi>Finding the Pi</h3>
            <p>My Pi is connected directly connected to my home network via ethernet. My main computers local IP address is 192.168.0.6; in order to
              <a href=http://www.raspberrypi.org/documentation/troubleshooting/hardware/networking/ip-address.md>find the Pi on the network</a> I could run <code>nmap -sn 192.168.0.0/24</code>. Interestingly nmap reports my Pi as an HP, I have an HP printer on the network which nmap was not finding.<pre><code>MAC Address: 78:AC:C0:xx:yy:zz (Hewlett-Packard Company)
Nmap scan report for 192.168.0.17
</code></pre>
              <p>I needed another method, I found a trusty USB keyboard and logged in.<pre><code># ip addr show
</code></pre>
                <p>Look near the bottom for <code>eth0</code> and you should find something akin to <code>inet 192.168.0.17/24</code>.
                  <h3 id=meta-data>Meta Data</h3>
                  <p>I should look into doing this using <code>localectl</code><pre><code># rnano /etc/locale.gen
# locale-gen
# echo LANG=en_US.UTF-8 &gt; /etc/locale.conf
# export LANG=en_US.UTF-8
# hostnamectl set-hostname arch-pi
</code></pre>
                    <h3 id=date-time>Date &amp; Time</h3>
                    <p>The Raspberry Pi doesn’t have a hardware clock. In order to have a good historical record it is vital the system to have the correct time. Using
                      <a href=http://www.pool.ntp.org/>pool.ntp.org</a>, pick the logical servers, to populate <code>/etc/systemd/timesyncd.conf</code>.<pre><code># rnano /etc/systemd/timesyncd.conf
# timedatectl set-timezone America/New_York
# timedatectl set-ntp true
# systemctl enable systemd-timedated
# systemctl enable systemd-timesyncd
</code></pre>
                      <p>Ironically, <code>America/Detroit</code> has issues; test the setup by checking the output of <code>timedatectl status</code>.
                        <h3 id=securing-pacman>Securing pacman</h3>
                        <p>Two different actions are need. First, and most importantly the Pi has a built in random number generator. Why would we leave random number generation up to software? We should use it right? For that, for that some tools are required
                          before telling the system
                          <a href="http://archlinuxarm.org/forum/viewtopic.php?f=31&amp;t=4993#p27708">where to find generator</a>. This
                          <strong>must</strong> be done before trusting the pacman-keys. Secondly, for those wearing tin-foil hats everything will be reinstalled.<pre><code># pacman -Syu rng-tools
# echo &#39;RNGD_OPTS=&quot;-o /dev/random -r /dev/hwrng&quot;&#39; &gt; /etc/conf.d/rngd
# systemctl enable rngd
# systemctl disable haveged.service

# pacman-key --init
# pacman -Sy archlinux-keyring
# pacman-key --populate archlinux
# pacman -Qenq | pacman -Sy -
</code></pre>
                          <h3 id=raspberry-pi-userspace-userspace->Raspberry Pi
                            <a href=https://github.com/raspberrypi/firmware>userspace</a>
                          </h3>
                          <p>We will follow the naming scheme use for the dynamic linker.<pre><code># cat /etc/ld.so.conf.d/00-raspberrypi-firmware.conf
</code></pre>
                            <p>This grants you easy access commands like
                              <a href=http://elinux.org/RPI_vcgencmd_usage title="vcgencmd usage"><code>vcgencmd</code></a>.<pre><code># echo &#39;export PATH=$PATH:/opt/vc/bin&#39; &gt; /etc/profile.d/00-raspberrypi-userspace.sh
</code></pre>
                              <h3 id=users>Users</h3><pre><code># passwd
# pacman -S sudo zsh
# useradd -m -G wheel -s /bin/zsh {my_user_name}
# passwd {my_user_name}
# echo &#39;%wheel ALL=(ALL) ALL&#39; &gt; /etc/sudoers.d/group_wheel_conf

## Same thing without a password
# %wheel ALL=(ALL) NOPASSWD: ALL
</code></pre>
                              <p>Test that I can log in then that I can use <code>sudo -l</code>
                                <h3 id=ssh>SSH</h3>
                                <p>Personally, I kind of like the suggestion found in
                                  <a href=https://stribika.github.io/2015/01/04/secure-secure-shell.html>Secure Secure Shell</a> posting, with a few riders; my
                                  <a href=https://gitlab.com/snippets/3795>sshd_config</a> is here.<pre><code># rm /etc/ssh/ssh_host_*key*
# ssh-keygen -t ed25519 -N &#39;&#39; -f /etc/ssh/ssh_host_ed25519_key
# ssh-keygen -t rsa -b 4096 -N &#39;&#39; -f /etc/ssh/ssh_host_rsa_key
# ln -s  /dev/null /etc/ssh/ssh_host_ecdsa_key
# ln -s  /dev/null /etc/ssh/ssh_host_dsa_key
# systemctl restart sshd.service
</code></pre>
                                  <h3 id=setting-swap-just-to-offset-ram-allocated-to-the-gpu->Setting Swap (just to offset RAM allocated to the GPU):</h3><pre><code># fallocate -l 32M /swapfile
# chmod 600 /swapfile
# mkswap /swapfile
# swapon /swapfile
# echo &#39;/swapfile none swap defaults 0 0&#39; &gt;&gt; /etc/fstab
# echo &#39;vm.swappiness=10&#39; &gt;&gt; /etc/sysctl.d/99-sysctl.conf
</code></pre>
                                  <h3 id=data-integurity>Data integurity</h3>
                                  <p>Early detection often is key to rectifying impediments; the Raspberry Pi has a long standing history of data corruption on the systems SD card. By default <code>fsck</code> will run every 30 boots. Chances are you don’t
                                    want to find out about data corruption at boot time, I believe checking the system every 8-16 days is a sane and precautionary tactic.<pre><code># tune2fs -i 8d /dev/mmcblk0p2
</code></pre>
                                    <h3 id=over-clocking>Over Clocking</h3>
                                    <p>Just follow this
                                      <a href=http://haydenjames.io/raspberry-pi-2-overclock/ title="Warning: The following link can display a spammy screen cover">link</a> if you are interested.</article>
    </main>
    <footer>
      <div class="small center">
        <p>So this is it. I mean, it&#x27;s not much, but it&#x27;s, you know...
          <br>
          <em>Copyright &copy; 2012 &mdash; 2017;
            <a href=http://twitter.com/mitchejj title=@mitchejj>Jason Mitchell</a>
          </em>
      </div>
    </footer>