<!DOCTYPE html>
<html lang=en-US>
  <meta content="width=device-width,initial-scale=1" name=viewport>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <meta content=nullog property=og:site_name>
  <meta content=en_US property=og:locale>
  <meta content=article property=og:type>
  <meta content="A few, important, fun and interesting things to do with systemd" property=og:description>
  <meta content=systemd property=og:title>
  <meta content=https://nullog.net/io/pi/systemd/ property=og:url>
  <meta content="Jason Mitchell" property=article:author>
  <meta content="" property=article:tag>
  <meta content=summary name=twitter:card>
  <meta content=@_nullog name=twitter:site>
  <meta content=@mitchejj name=twitter:creator>
  <link href=//humans.txt rel=author type=text/plain>
  <title>systemd | nullog</title>
  <link href=https://nullog.net//io/pi/systemd/ rel=canonical>
  <link href=/nullog.css rel=stylesheet>
  <body class=nullog>
    <header class="center site-header">
      <h1 class="center lowercase site-title">
        <a href=/>nullog</a>
      </h1>
      <nav class="lowercase site-nav">
        <ul>
          <li class=nav-node>
            <h2 class=small>
              <a href=/about/>about</a>
            </h2>
            <li class=nav-node>
              <h2 class=small>
                <a href=/all/>explore</a>
              </h2>
              <li class=nav-node>
                <h2 class=small>
                  <a href=/io/>io</a>
                </h2>
        </ul>
      </nav>
    </header>
    <main class=nullog-body>
      <article class=page>
        <header class=title>
          <h2 class=lowercase>systemd
            <span class=mute> the everyday tool</span>
          </h2>
        </header>
        <p>useradd -m -u 502 -G wheel -s /bin/zsh jason
          <p>
            <a href=http://www.life-beam.com/product/smart-hat/#>http://www.life-beam.com/product/smart-hat/#</a>
            <p>
              <a href=http://blog.volcanis.me/2014/06/01/systemd-networkd/>http://blog.volcanis.me/2014/06/01/systemd-networkd/</a>
              <p>A few interesting commands
                <p>systemctl –state=failed
                  <p>autovt@.service
                    <p>journalctl -p 0..3 -xn
                      <p>systemd-analyze blame
                        <p>systemctl list-machines<pre><code> -t /dev/mmcblk0
</code></pre>
                          <p>
                            <a href="https://www.archlinux.org/packages/?name=irqbalance">https://www.archlinux.org/packages/?name=irqbalance</a> irqbalance.service<pre><code>  omxplayer



  https://wiki.archlinux.org/index.php/Systemd-nspawn

  machinectl -a




  http://www.raspberrypi.org/forums/viewtopic.php?f=53&amp;t=105027
</code></pre>
                            <p>I’m going to take a semi-unpopular position and say I actually think
                              <a href=https://wiki.freedesktop.org/www/Software/systemd/>systemd</a> is a fascinating technology. I’ve also found the concept of software containers interesting yet I’ve never been able to wrap my head around docker. Ironaccly this actical centers around a systemd afterthought
                              systemd-nspawn.
                              <p>I believe the big reason is I don’t have a good justifiable use for everything, and thus complexity, docker brings to the table.
                                <p>Which brings me to <code>systemd-nspawn</code>, to be it wonderful way to have multiple sandboxes (containers) in playground (Pi). On my current system I have another drive with a btrf partion for ‘/home’ and ‘/var’. I
                                  did this for two reasons.
                                  <ul>
                                    <li>larger drive
                                      <ul>
                                        <li>the pacman cache is on /var so more space is always welcomed
                                          <li>/home can grow fairly large</ul>
                                      <li>built in compression
                                        <li>self healing
                                          <ul>
                                            <li>Copy-on-Write
                                              <ul>
                                                <li>useful for my containers</ul>
                                          </ul>
                                  </ul>
                                  <p>I have created a base container, the populate it. I’m also installing nfs-utils since I want to share ‘/var/cache/pacman/pkg’ across the host system and the guest systems.
                                    <h1 id=btrfs-subvolume-create-guest_base>btrfs subvolume create guest_base</h1>
                                    <h1 id=pacstrap-i-c-d-guest_base-base-nfs-utils>pacstrap -i -c -d guest_base base nfs-utils</h1>
                                    <h1 id=echo-localhost-var-cache-pacman-pkg-var-cache-pacman-pkg-nfs-auto-x-systemd-automount-x-systemd-device-timeout-10-timeo-14-0-0-guest_base-etc-fstab>echo ‘localhost:/var/cache/pacman/pkg /var/cache/pacman/pkg nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14 0 0’ &gt;&gt; guest_base/etc/fstab</h1>
                                    <p>pacman -Syu arch-install-scripts nfs-utils btrfs-progs btrfs subvolume create base
                                      <p>pacstrap -i -c -d base base nfs-utils
                                        <p>^cryptsetup, lvm2 mdadm pciutils reiserfsprogs s-nail usbutils vi xfsprogs jfsutils ^4 ^25 ^28 ^33 ^37 ^38 ^45 ^47 ^49 ^21
                                          <p>localhost:/var/cache/pacman/pkg /var/cache/pacman/pkg nfs noauto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14 0 0
                                            <p>mount -t nfs localhost:/var/cache/pacman/pkg /var/cache/pacman/pkg</article>
    </main>
    <footer>
      <div class="small center">
        <p>So this is it. I mean, it&#x27;s not much, but it&#x27;s, you know...
          <br>
          <em>Copyright &copy; 2012 &mdash; 2017;
            <a href=http://twitter.com/mitchejj title=@mitchejj>Jason Mitchell</a>
          </em>
      </div>
    </footer>